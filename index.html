<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arijeem Insight 360 | Pepsi Enterprise System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">
    
    <!-- Database Status Indicator -->
    <div id="dbStatus" style="display: none; position: fixed; top: 10px; right: 10px; background: #10b981; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; z-index: 10000;">
        <i class="fas fa-database"></i> Database Connected
    </div>
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="pepsi-loader">
                <div class="pepsi-circle blue"></div>
                <div class="pepsi-circle red"></div>
                <div class="pepsi-circle white"></div>
            </div>
            <h2>Arijeem Insight 360</h2>
            <p id="loadingMessage">Connecting to Database...</p>
            <div id="databaseStatus" style="margin-top: 20px; font-size: 14px;">
                <i class="fas fa-spinner fa-spin"></i> Initializing database connection...
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="mainContainer" style="display: none;">
        
        <!-- ===== SETUP SCREEN ===== -->
        <div id="setupScreen" class="setup-container">
            <div class="setup-header">
                <div class="setup-logo">
                    <span class="logo-icon">ðŸš€</span>
                    <h1>Arijeem <span class="blue-text">Insight</span> <span class="red-text">360</span></h1>
                </div>
                <p class="setup-subtitle">First-Time System Setup</p>
                <div class="setup-status" id="setupDatabaseStatus">
                    <i class="fas fa-database"></i> Database: <span id="dbStatusText">Initializing...</span>
                </div>
            </div>

            <!-- Setup Wizard -->
            <div class="setup-wizard">
                <!-- Step 1: General Manager Account -->
                <div id="step1" class="setup-step active">
                    <div class="step-header">
                        <span class="step-number">1</span>
                        <h3>Create General Manager Account</h3>
                    </div>
                    
                    <div class="step-content">
                        <div class="setup-info">
                            <i class="fas fa-info-circle"></i>
                            <p>This account will have full system control with all access codes.</p>
                        </div>
                        
                        <div class="input-group">
                            <label><i class="fas fa-user-tie"></i> General Manager Full Name</label>
                            <input type="text" id="gmName" placeholder="General Manager" class="form-control" required>
                        </div>
                        
                        <div class="input-group">
                            <label><i class="fas fa-envelope"></i> General Manager Email</label>
                            <input type="email" id="gmEmail" placeholder="gm@arijeem.pepsi.com" class="form-control" required>
                        </div>
                        
                        <div class="input-group">
                            <label><i class="fas fa-lock"></i> General Manager Password</label>
                            <div class="password-wrapper">
                                <input type="password" id="gmPassword" placeholder="Create strong password" class="form-control" required minlength="8">
                                <button type="button" class="toggle-password" onclick="togglePassword('gmPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="password-hint">Password will be encrypted and stored securely</small>
                        </div>
                        
                        <div class="input-group">
                            <label><i class="fas fa-lock"></i> Confirm Password</label>
                            <input type="password" id="gmConfirmPassword" placeholder="Re-enter password" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-next" onclick="goToStep(2)">
                            Next: Security Codes <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Security Codes -->
                <div id="step2" class="setup-step">
                    <div class="step-header">
                        <span class="step-number">2</span>
                        <h3>Set Security Codes</h3>
                    </div>
                    
                    <div class="step-content">
                        <div class="setup-info">
                            <i class="fas fa-shield-alt"></i>
                            <p>Security codes for multi-layer authentication.</p>
                        </div>
                        
                        <div class="security-codes">
                            <div class="code-item">
                                <div class="code-icon">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="code-info">
                                    <h4>Entry Code</h4>
                                    <p>Required for all user logins</p>
                                    <input type="text" id="entryCode" placeholder="4 digits" maxlength="4" class="code-input" oninput="validateNumeric(this)" required>
                                    <small class="code-hint">Will be stored in database</small>
                                </div>
                            </div>
                            
                            <div class="code-item">
                                <div class="code-icon">
                                    <i class="fas fa-boxes"></i>
                                </div>
                                <div class="code-info">
                                    <h4>Stock Code</h4>
                                    <p>Admin/General Manager stock operations</p>
                                    <input type="text" id="stockCode" placeholder="6 digits" maxlength="6" class="code-input" oninput="validateNumeric(this)" required>
                                    <small class="code-hint">For inventory management</small>
                                </div>
                            </div>
                            
                            <div class="code-item">
                                <div class="code-icon">
                                    <i class="fas fa-user-crown"></i>
                                </div>
                                <div class="code-info">
                                    <h4>Override Code</h4>
                                    <p>General Manager emergency access</p>
                                    <input type="text" id="overrideCode" placeholder="8 digits" maxlength="8" class="code-input" oninput="validateNumeric(this)" required>
                                    <small class="code-hint">General Manager privilege only</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-back" onclick="goToStep(1)">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="btn-next" onclick="goToStep(3)">
                            Next: Team Setup <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Team Setup -->
                <div id="step3" class="setup-step">
                    <div class="step-header">
                        <span class="step-number">3</span>
                        <h3>Setup Team Accounts</h3>
                    </div>
                    
                    <div class="step-content">
                        <div class="setup-info">
                            <i class="fas fa-users"></i>
                            <p>Create team accounts with role-based permissions.</p>
                        </div>
                        
                        <div class="team-grid">
                            <!-- Admin -->
                            <div class="team-card">
                                <div class="team-header admin">
                                    <i class="fas fa-user-tie"></i>
                                    <h4>Admin</h4>
                                    <span class="team-badge">Stock Access</span>
                                </div>
                                <div class="team-body">
                                    <input type="email" id="adminEmail" placeholder="admin@arijeem.pepsi.com" class="team-input" value="admin@arijeem.pepsi.com" required>
                                    <div class="password-wrapper">
                                        <input type="password" id="adminPassword" placeholder="Admin Password" class="team-input" value="Admin@123" required minlength="6">
                                        <button type="button" class="toggle-password" onclick="togglePassword('adminPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <input type="text" id="adminName" placeholder="Admin Name" class="team-input" value="System Administrator" required>
                                </div>
                                <div class="team-footer">
                                    <small><i class="fas fa-database"></i> Database table: users</small>
                                </div>
                            </div>
                            
                            <!-- Sales Management -->
                            <div class="team-card">
                                <div class="team-header staff">
                                    <i class="fas fa-chart-line"></i>
                                    <h4>Sales Management</h4>
                                    <span class="team-badge">Entry Access</span>
                                </div>
                                <div class="team-body">
                                    <input type="email" id="salesEmail" placeholder="sales@arijeem.pepsi.com" class="team-input" value="sales@arijeem.pepsi.com" required>
                                    <div class="password-wrapper">
                                        <input type="password" id="salesPassword" placeholder="Sales Password" class="team-input" value="Sales@123" required minlength="6">
                                        <button type="button" class="toggle-password" onclick="togglePassword('salesPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <input type="text" id="salesName" placeholder="Sales Manager Name" class="team-input" value="Sales Manager" required>
                                </div>
                                <div class="team-footer">
                                    <small><i class="fas fa-database"></i> Database table: users</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setup-warning">
                            <i class="fas fa-info-circle"></i>
                            <p><strong>Note:</strong> All team accounts have pre-filled values. You can modify passwords as needed.</p>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-back" onclick="goToStep(2)">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="btn-setup" onclick="completeSetup()">
                            <i class="fas fa-check"></i> Complete Setup & Save to Database
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="setup-footer">
                <p><i class="fas fa-database"></i> Connected to: <strong>twnbpdqssvzuvdlfzdum.supabase.co</strong></p>
                <p>Â© 2024 Arijeem Multipurpose Enterprises | Under Pepsi Corporation</p>
                <p class="setup-version">v2.0.0 | Real Database System</p>
            </div>
        </div>

        <!-- ===== LOGIN SCREEN ===== -->
        <div id="loginScreen" class="login-container" style="display: none;">
            <div class="login-header">
                <div class="login-logo">
                    <span class="logo-icon">ðŸ“Š</span>
                    <h1>Arijeem <span class="blue-text">Insight</span> <span class="red-text">360</span></h1>
                </div>
                <p class="login-subtitle">Enterprise Control System</p>
                <div class="login-db-status">
                    <i class="fas fa-database"></i>
                    <span id="loginDbStatus">Database Connected</span>
                    <span class="db-product-count">â€¢ 24 Products Available</span>
                </div>
            </div>

            <div class="login-card">
                <div class="role-selector">
                    <h3><i class="fas fa-user-shield"></i> Select Access Level</h3>
                    <p class="role-subtitle">Authentication via database records</p>
                    <div class="role-grid">
                        <button class="role-btn general-manager" onclick="selectRole('General Manager')">
                            <i class="fas fa-crown"></i>
                            <span>General Manager</span>
                            <small>Full Database Access</small>
                        </button>
                        <button class="role-btn admin" onclick="selectRole('Admin')">
                            <i class="fas fa-user-tie"></i>
                            <span>Admin</span>
                            <small>Database Management</small>
                        </button>
                        <button class="role-btn sales-management" onclick="selectRole('Sales Management')">
                            <i class="fas fa-chart-line"></i>
                            <span>Sales Management</span>
                            <small>Sales Database Access</small>
                        </button>
                    </div>
                </div>

                <div class="login-form">
                    <h3><i class="fas fa-lock"></i> Database Authentication</h3>
                    
                    <div class="input-group">
                        <label><i class="fas fa-envelope"></i> Email Address</label>
                        <input type="email" id="loginEmail" placeholder="your@email.com" class="form-control" required>
                        <small class="field-hint">Must exist in users table</small>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-key"></i> Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="form-control" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="field-hint">Verified against database</small>
                    </div>

                    <div class="security-layers">
                        <div class="input-group">
                            <label class="security-label">
                                <i class="fas fa-door-closed"></i> Entry Code
                                <span class="security-level">Required</span>
                            </label>
                            <input type="password" id="loginEntryCode" placeholder="XXXX" maxlength="4" class="security-input" oninput="validateNumeric(this)" required>
                            <small class="field-hint">From users.entry_code column</small>
                        </div>

                        <div class="input-group stock-code-input" style="display: none;">
                            <label class="security-label">
                                <i class="fas fa-boxes"></i> Stock Code
                                <span class="security-level">Admin/General Manager</span>
                            </label>
                            <input type="password" id="loginStockCode" placeholder="XXXXXX" maxlength="6" class="security-input" oninput="validateNumeric(this)" required>
                            <small class="field-hint">From users.stock_code column</small>
                        </div>

                        <div class="input-group override-code-input" style="display: none;">
                            <label class="security-label">
                                <i class="fas fa-user-crown"></i> Override Code
                                <span class="security-level red-text">General Manager Only</span>
                            </label>
                            <input type="password" id="loginOverrideCode" placeholder="XXXXXXXX" maxlength="8" class="security-input" oninput="validateNumeric(this)" required>
                            <small class="field-hint">From users.override_code column</small>
                        </div>
                    </div>

                    <div class="login-actions">
                        <button class="btn-login" onclick="login()">
                            <i class="fas fa-sign-in-alt"></i> Login with Database
                        </button>
                    </div>

                    <div class="security-info">
                        <p><i class="fas fa-database"></i> All credentials verified against database tables</p>
                        <p><i class="fas fa-history"></i> Login attempts logged in database</p>
                    </div>
                </div>
            </div>

            <div class="login-footer">
                <p><i class="fas fa-server"></i> Database: Supabase â€¢ Tables: 5 â€¢ Products: 24</p>
                <p>Â© 2024 Arijeem Multipurpose Enterprises | Under Pepsi Corporation</p>
                <p class="login-version">v2.0.0 | Real Database Authentication</p>
            </div>
        </div>

        <!-- ===== GENERAL MANAGER DASHBOARD ===== -->
        <div id="generalManagerDashboard" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <div class="header-left">
                    <button class="btn-back" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="user-info">
                        <div class="avatar gm-avatar">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div>
                            <h2 id="gmUserName">General Manager Dashboard</h2>
                            <p class="user-email" id="gmUserEmail">gm@arijeem.pepsi.com</p>
                            <p class="user-db-id" id="gmUserId"><i class="fas fa-id-card"></i> Database ID: <span id="userIdText">Loading...</span></p>
                        </div>
                    </div>
                </div>
                <div class="header-center">
                    <h1><span class="blue-text">General Manager</span> <span class="red-text">Dashboard</span></h1>
                    <div class="live-status">
                        <span class="status-dot active"></span>
                        <span>Live Database Connection</span>
                        <span class="db-connection">
                            <i class="fas fa-database"></i>
                            <span id="dbConnectionStatus">Connected</span>
                        </span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="time-display">
                        <i class="fas fa-clock"></i>
                        <span id="currentTime">00:00:00</span>
                    </div>
                    <button class="btn-alert" onclick="showAlerts()">
                        <i class="fas fa-bell"></i>
                        <span class="alert-badge" id="alertCount">0</span>
                    </button>
                    <div class="db-stats">
                        <i class="fas fa-chart-bar"></i>
                        <span id="liveStats">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats" id="gmQuickStats">
                <!-- Loaded from database -->
            </div>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <div class="dashboard-left">
                    <!-- Sales Chart -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Sales Overview</h3>
                            <div class="card-subtitle">Real-time data from database</div>
                            <button class="btn-card-action" onclick="viewSalesReport()">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="chart-footer">
                            <i class="fas fa-database"></i> Data Source: <code>sales</code> table
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Database Activity</h3>
                            <div class="card-subtitle">Live updates from stock_changes</div>
                            <button class="btn-card-action" onclick="viewActivityLogs()">
                                View All
                            </button>
                        </div>
                        <div class="activity-list" id="gmActivityList">
                            <!-- Loaded from database -->
                        </div>
                        <div class="activity-footer">
                            <i class="fas fa-database"></i> Source: <code>stock_changes</code> table
                        </div>
                    </div>
                </div>

                <div class="dashboard-right">
                    <!-- Quick Actions -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Database Actions</h3>
                        </div>
                        <div class="action-grid">
                            <button class="btn-action" onclick="showAddStockForm()">
                                <i class="fas fa-plus-circle"></i>
                                <span>Add Stock</span>
                                <small>Update products table</small>
                            </button>
                            <button class="btn-action" onclick="showRecordSaleForm()">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Record Sale</span>
                                <small>Add to sales table</small>
                            </button>
                            <button class="btn-action" onclick="showGenerateReport()">
                                <i class="fas fa-file-export"></i>
                                <span>Generate Report</span>
                                <small>Export all tables</small>
                            </button>
                            <button class="btn-action" onclick="showUserManagement()">
                                <i class="fas fa-users-cog"></i>
                                <span>User Management</span>
                                <small>Update users table</small>
                            </button>
                            <button class="btn-action" onclick="showOverridePriceForm()">
                                <i class="fas fa-user-crown"></i>
                                <span>Override Price</span>
                                <small>Emergency price change</small>
                            </button>
                            <button class="btn-action" onclick="showProductManagement()">
                                <i class="fas fa-box-open"></i>
                                <span>Manage Products</span>
                                <small>Browse all products</small>
                            </button>
                        </div>
                    </div>

                    <!-- Low Stock -->
                    <div class="dashboard-card alert-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-circle red-text"></i> Low Stock Alert</h3>
                            <div class="card-subtitle">Real-time monitoring</div>
                        </div>
                        <div class="stock-list" id="lowStockList">
                            <!-- Loaded from database -->
                        </div>
                        <div class="stock-footer">
                            <i class="fas fa-database"></i> Monitored: <code>products.current_qty</code>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-server"></i> Database Status</h3>
                        </div>
                        <div class="status-list">
                            <div class="status-item online">
                                <i class="fas fa-check-circle"></i>
                                <span>Supabase Connection</span>
                                <span class="status-text" id="dbStatusIndicator">Online</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-check-circle"></i>
                                <span>Tables Access</span>
                                <span class="status-text">5/5 Tables</span>
                            </div>
                            <div class="status-item online">
                                <i class="fas fa-check-circle"></i>
                                <span>Real-time Updates</span>
                                <span class="status-text">Active</span>
                            </div>
                            <div class="status-item">
                                <i class="fas fa-box"></i>
                                <span>Products</span>
                                <span class="status-text" id="productCountStatus">24 Items</span>
                            </div>
                            <div class="status-item">
                                <i class="fas fa-users"></i>
                                <span>Users</span>
                                <span class="status-text" id="userCountStatus">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Footer -->
            <div class="dashboard-footer">
                <div class="footer-left">
                    <span><i class="fas fa-database"></i> Database: <strong>Supabase</strong></span>
                    <span><i class="fas fa-table"></i> Active Tables: <strong id="activeTables">5</strong></span>
                    <span><i class="fas fa-clock"></i> Session: <span id="sessionTimer">30:00</span></span>
                </div>
                <div class="footer-right">
                    <button class="btn-footer" onclick="printReport()">
                        <i class="fas fa-print"></i> Print Dashboard
                    </button>
                    <button class="btn-footer" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn-footer" onclick="showDatabaseInfo()">
                        <i class="fas fa-info-circle"></i> DB Info
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== ADMIN DASHBOARD ===== -->
        <div id="adminDashboard" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <div class="header-left">
                    <button class="btn-back" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="user-info">
                        <div class="avatar admin-avatar">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div>
                            <h2 id="adminUserName">Admin Dashboard</h2>
                            <p class="user-email" id="adminUserEmail">admin@arijeem.pepsi.com</p>
                            <p class="user-db-id" id="adminUserId"><i class="fas fa-id-card"></i> Database ID: <span id="adminIdText">Loading...</span></p>
                        </div>
                    </div>
                </div>
                <div class="header-center">
                    <h1><span class="blue-text">Admin</span> <span class="red-text">Dashboard</span></h1>
                    <div class="live-status">
                        <span class="status-dot active"></span>
                        <span>Live Database Connection</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="time-display">
                        <i class="fas fa-clock"></i>
                        <span id="adminCurrentTime">00:00:00</span>
                    </div>
                    <div class="db-stats">
                        <i class="fas fa-chart-bar"></i>
                        <span id="adminLiveStats">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Admin Quick Stats -->
            <div class="quick-stats" id="adminQuickStats">
                <!-- Loaded from database -->
            </div>

            <!-- Admin Dashboard Content -->
            <div class="dashboard-content">
                <div class="dashboard-left">
                    <!-- Sales Chart -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Sales Overview</h3>
                            <div class="card-subtitle">Real-time data from database</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="adminSalesChart"></canvas>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Stock Changes</h3>
                        </div>
                        <div class="activity-list" id="adminActivityList">
                            <!-- Loaded from database -->
                        </div>
                    </div>
                </div>

                <div class="dashboard-right">
                    <!-- Admin Actions -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Admin Actions</h3>
                        </div>
                        <div class="action-grid">
                            <button class="btn-action" onclick="showAddStockForm()">
                                <i class="fas fa-plus-circle"></i>
                                <span>Add Stock</span>
                                <small>Update products table</small>
                            </button>
                            <button class="btn-action" onclick="showRecordSaleForm()">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Record Sale</span>
                                <small>Add to sales table</small>
                            </button>
                            <button class="btn-action" onclick="showProductManagement()">
                                <i class="fas fa-box-open"></i>
                                <span>View Products</span>
                                <small>Browse all products</small>
                            </button>
                            <button class="btn-action" onclick="refreshAdminDashboard()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Refresh Data</span>
                                <small>Update from database</small>
                            </button>
                        </div>
                    </div>

                    <!-- Low Stock -->
                    <div class="dashboard-card alert-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-circle red-text"></i> Low Stock Alert</h3>
                        </div>
                        <div class="stock-list" id="adminLowStockList">
                            <!-- Loaded from database -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard Footer -->
            <div class="dashboard-footer">
                <div class="footer-left">
                    <span><i class="fas fa-database"></i> Database: <strong>Supabase</strong></span>
                    <span><i class="fas fa-user-tie"></i> Role: <strong>Admin</strong></span>
                    <span><i class="fas fa-clock"></i> Session: <span id="adminSessionTimer">30:00</span></span>
                </div>
                <div class="footer-right">
                    <button class="btn-footer" onclick="refreshAdminDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== SALES MANAGEMENT DASHBOARD ===== -->
        <div id="salesDashboard" class="dashboard-container" style="display: none;">
            <div class="dashboard-header">
                <div class="header-left">
                    <button class="btn-back" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="user-info">
                        <div class="avatar sales-avatar">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <h2 id="salesUserName">Sales Management Dashboard</h2>
                            <p class="user-email" id="salesUserEmail">sales@arijeem.pepsi.com</p>
                        </div>
                    </div>
                </div>
                <div class="header-center">
                    <h1><span class="blue-text">Sales Management</span> <span class="red-text">Dashboard</span></h1>
                </div>
                <div class="header-right">
                    <div class="time-display">
                        <i class="fas fa-clock"></i>
                        <span id="salesCurrentTime">00:00:00</span>
                    </div>
                </div>
            </div>

            <!-- Sales Quick Stats -->
            <div class="quick-stats" id="salesQuickStats">
                <!-- Loaded from database -->
            </div>

            <!-- Sales Dashboard Content -->
            <div class="dashboard-content">
                <div class="dashboard-left">
                    <!-- Sales Chart -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Sales Performance</h3>
                            <div class="card-subtitle">Today's sales data</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesManagementChart"></canvas>
                        </div>
                    </div>

                    <!-- Recent Sales -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Sales</h3>
                        </div>
                        <div class="activity-list" id="salesActivityList">
                            <!-- Loaded from database -->
                        </div>
                    </div>
                </div>

                <div class="dashboard-right">
                    <!-- Sales Actions -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bolt"></i> Sales Actions</h3>
                        </div>
                        <div class="action-grid">
                            <button class="btn-action" onclick="showRecordSaleForm()">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Record New Sale</span>
                                <small>Add to sales table</small>
                            </button>
                            <button class="btn-action" onclick="viewSalesReport()">
                                <i class="fas fa-file-alt"></i>
                                <span>View Sales Report</span>
                                <small>Daily sales summary</small>
                            </button>
                            <button class="btn-action" onclick="viewProductCatalog()">
                                <i class="fas fa-box-open"></i>
                                <span>Product Catalog</span>
                                <small>Browse products</small>
                            </button>
                            <button class="btn-action" onclick="refreshSalesDashboard()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Refresh Data</span>
                                <small>Update from database</small>
                            </button>
                        </div>
                    </div>

                    <!-- Top Products -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-star"></i> Top Selling Products</h3>
                        </div>
                        <div class="stock-list" id="topProductsList">
                            <!-- Loaded from database -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Dashboard Footer -->
            <div class="dashboard-footer">
                <div class="footer-left">
                    <span><i class="fas fa-database"></i> Database: <strong>Supabase</strong></span>
                    <span><i class="fas fa-chart-line"></i> Role: <strong>Sales Management</strong></span>
                    <span><i class="fas fa-clock"></i> Session: <span id="salesSessionTimer">30:00</span></span>
                </div>
            </div>
        </div>

        <!-- ===== ACTION FORMS (ON-PAGE, NOT POPUPS) ===== -->
        
        <!-- Add Stock Form -->
        <div id="addStockForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-plus-circle"></i> Add Stock to Product</h3>
                    <button class="btn-close-form" onclick="closeForm('addStockForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="input-group">
                        <label><i class="fas fa-box"></i> Select Product</label>
                        <select id="addStockProduct" class="form-control" required>
                            <option value="">Loading products...</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-hashtag"></i> Quantity to Add</label>
                        <input type="number" id="addStockQuantity" class="form-control" placeholder="Enter quantity" min="1" required>
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-sticky-note"></i> Reason (Optional)</label>
                        <textarea id="addStockReason" class="form-control" placeholder="E.g., New shipment, Returned goods, etc." rows="2"></textarea>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('addStockForm')">
                        Cancel
                    </button>
                    <button class="btn-confirm" onclick="submitAddStock()">
                        <i class="fas fa-check"></i> Confirm Add Stock
                    </button>
                </div>
            </div>
        </div>

        <!-- Record Sale Form -->
        <div id="recordSaleForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-shopping-cart"></i> Record New Sale</h3>
                    <button class="btn-close-form" onclick="closeForm('recordSaleForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="sale-form-grid">
                        <div class="input-group">
                            <label><i class="fas fa-box"></i> Product</label>
                            <select id="saleProduct" class="form-control" required onchange="updateSalePrice()">
                                <option value="">Select product...</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-hashtag"></i> Quantity</label>
                            <input type="number" id="saleQuantity" class="form-control" placeholder="Qty" min="1" value="1" oninput="updateSaleTotal()" required>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-tag"></i> Sale Type</label>
                            <select id="saleType" class="form-control" required onchange="updateSalePrice()">
                                <option value="RETAIL">Retail</option>
                                <option value="WHOLESALE">Wholesale</option>
                                <option value="RETAIL_CAN">Retail (Can)</option>
                                <option value="WHOLESALE_CAN">Wholesale (Can)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-money-bill"></i> Unit Price (â‚¦)</label>
                            <input type="number" id="saleUnitPrice" class="form-control" placeholder="Price per unit" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-calculator"></i> Total Amount (â‚¦)</label>
                            <input type="number" id="saleTotalAmount" class="form-control" readonly>
                        </div>
                        <div class="input-group full-width">
                            <label><i class="fas fa-user"></i> Customer Name (Optional)</label>
                            <input type="text" id="saleCustomer" class="form-control" placeholder="Customer name">
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('recordSaleForm')">
                        Cancel
                    </button>
                    <button class="btn-confirm" onclick="submitSale()">
                        <i class="fas fa-check"></i> Confirm Sale
                    </button>
                </div>
            </div>
        </div>

        <!-- Override Price Form -->
        <div id="overridePriceForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-user-crown red-text"></i> Override Price (General Manager Only)</h3>
                    <button class="btn-close-form" onclick="closeForm('overridePriceForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="security-warning">
                        <i class="fas fa-shield-alt"></i>
                        <p><strong>Security Check Required:</strong> Please enter your Override Code to continue.</p>
                        <input type="password" id="overrideSecurityCode" class="security-input" placeholder="Enter 8-digit override code" maxlength="8" oninput="validateNumeric(this)">
                    </div>
                    <div class="override-form-grid">
                        <div class="input-group">
                            <label><i class="fas fa-box"></i> Select Product</label>
                            <select id="overrideProduct" class="form-control" required>
                                <option value="">Loading products...</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-tag"></i> New Retail Price (â‚¦)</label>
                            <input type="number" id="overrideRetailPrice" class="form-control" placeholder="Enter new retail price" step="0.01" min="0" required>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-tag"></i> New Wholesale Price (â‚¦)</label>
                            <input type="number" id="overrideWholesalePrice" class="form-control" placeholder="Enter new wholesale price" step="0.01" min="0" required>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-sticky-note"></i> Reason for Override</label>
                            <textarea id="overrideReason" class="form-control" placeholder="Explain why this price change is necessary" rows="3" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('overridePriceForm')">
                        Cancel
                    </button>
                    <button class="btn-confirm" onclick="submitPriceOverride()">
                        <i class="fas fa-check"></i> Confirm Price Override
                    </button>
                </div>
            </div>
        </div>

        <!-- Generate Report Form -->
        <div id="generateReportForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-file-export"></i> Generate Database Report</h3>
                    <button class="btn-close-form" onclick="closeForm('generateReportForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="report-options">
                        <div class="input-group">
                            <label><i class="fas fa-calendar"></i> Report Period</label>
                            <select id="reportPeriod" class="form-control" required>
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="this_week">This Week</option>
                                <option value="last_week">Last Week</option>
                                <option value="this_month">This Month</option>
                                <option value="last_month">Last Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div class="date-range" id="customDateRange" style="display: none;">
                            <div class="input-group">
                                <label>Start Date</label>
                                <input type="date" id="reportStartDate" class="form-control">
                            </div>
                            <div class="input-group">
                                <label>End Date</label>
                                <input type="date" id="reportEndDate" class="form-control">
                            </div>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-file"></i> Report Type</label>
                            <select id="reportType" class="form-control" required>
                                <option value="sales">Sales Report</option>
                                <option value="stock">Stock Report</option>
                                <option value="products">Products Report</option>
                                <option value="users">Users Report</option>
                                <option value="full">Full Database Export</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-download"></i> Export Format</label>
                            <div class="format-options">
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="csv" checked>
                                    <span>CSV (Excel)</span>
                                </label>
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="pdf">
                                    <span>PDF</span>
                                </label>
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="print">
                                    <span>Print</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('generateReportForm')">
                        Cancel
                    </button>
                    <button class="btn-confirm" onclick="generateReportNow()">
                        <i class="fas fa-download"></i> Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- User Management Form -->
        <div id="userManagementForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-users-cog"></i> User Management</h3>
                    <button class="btn-close-form" onclick="closeForm('userManagementForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="user-list" id="userListContainer">
                        <h4><i class="fas fa-users"></i> Current Users</h4>
                        <div class="users-table" id="usersTable">
                            Loading users...
                        </div>
                    </div>
                    <div class="add-user-form">
                        <h4><i class="fas fa-user-plus"></i> Add New User</h4>
                        <div class="input-group">
                            <label><i class="fas fa-user"></i> Full Name</label>
                            <input type="text" id="newUserName" class="form-control" placeholder="Enter full name">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="newUserEmail" class="form-control" placeholder="user@arijeem.pepsi.com">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-user-tag"></i> Role</label>
                            <select id="newUserRole" class="form-control">
                                <option value="Admin">Admin</option>
                                <option value="Sales Management">Sales Management</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-lock"></i> Password</label>
                            <input type="password" id="newUserPassword" class="form-control" placeholder="Enter password">
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('userManagementForm')">
                        Cancel
                    </button>
                    <button class="btn-confirm" onclick="addNewUser()">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
            </div>
        </div>

        <!-- Product Management Form -->
        <div id="productManagementForm" class="action-form-container" style="display: none;">
            <div class="action-form">
                <div class="form-header">
                    <h3><i class="fas fa-box-open"></i> Product Management</h3>
                    <button class="btn-close-form" onclick="closeForm('productManagementForm')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="form-body">
                    <div class="product-list" id="productListContainer">
                        <h4><i class="fas fa-boxes"></i> All Products</h4>
                        <div class="products-table" id="productsTable">
                            Loading products...
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button class="btn-back" onclick="closeForm('productManagementForm')">
                        Close
                    </button>
                    <button class="btn-confirm" onclick="refreshProductList()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Info Modal -->
    <div id="dbInfoModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3><i class="fas fa-database"></i> Database Connection Info</h3>
            <div class="db-info">
                <p><strong>Status:</strong> <span id="modalDbStatus" class="success">Connected</span></p>
                <p><strong>URL:</strong> <code>twnbpdqssvzuvdlfzdum.supabase.co</code></p>
                <p><strong>Tables Created:</strong> 5 tables</p>
                <p><strong>Products Loaded:</strong> 24 items</p>
                <p><strong>Users:</strong> <span id="modalUserCount">0</span> accounts</p>
                <p><strong>Last Sync:</strong> <span id="lastSyncTime">Just now</span></p>
            </div>
            <button class="btn-close" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="database.js"></script>
    <script src="script.js"></script>
    
    <!-- Simple initialization only -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Simple validation helper
            window.validateNumeric = function(input) {
                input.value = input.value.replace(/[^0-9]/g, '');
            };
            
            // Modal functions
            window.showDatabaseInfo = function() {
                const modal = document.getElementById('dbInfoModal');
                if (modal) modal.style.display = 'flex';
            };
            
            window.closeModal = function() {
                const modal = document.getElementById('dbInfoModal');
                if (modal) modal.style.display = 'none';
            };
            
            window.printReport = function() {
                window.print();
            };
        });
    </script>
    <script>
// IMMEDIATE FIX FOR HTML DISPLAY
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸ”§ Checking for price doubling in HTML...');
    
    // Wait a bit for prices to load
    setTimeout(function() {
        // Fix all price displays
        document.querySelectorAll('*').forEach(element => {
            const text = element.textContent || element.value || '';
            
            // Fix â‚¦4,200 and â‚¦4,150
            if (text.includes('4200') || text.includes('4150') || 
                text.includes('â‚¦4,200') || text.includes('â‚¦4,150')) {
                
                console.log('ðŸš¨ Found doubled price in HTML:', element);
                
                // Replace with correct prices
                if (element.textContent) {
                    element.textContent = element.textContent
                        .replace('4200', '2200')
                        .replace('4150', '2150')
                        .replace('â‚¦4,200', 'â‚¦2,200')
                        .replace('â‚¦4,150', 'â‚¦2,150');
                }
                
                if (element.value) {
                    element.value = element.value
                        .replace('4200', '2200')
                        .replace('4150', '2150');
                }
                
                if (element.innerHTML) {
                    element.innerHTML = element.innerHTML
                        .replace('4200', '2200')
                        .replace('4150', '2150')
                        .replace('â‚¦4,200', 'â‚¦2,200')
                        .replace('â‚¦4,150', 'â‚¦2,150');
                }
            }
        });
        
        console.log('âœ… HTML price fix applied');
    }, 1000);
});

// Also monitor for dynamic price changes
setInterval(function() {
    const elements = document.querySelectorAll('[id*="price"], [class*="price"], input[type="number"]');
    elements.forEach(el => {
        const val = el.value || el.textContent || '';
        if (val === '4200' || val === '4150' || val === 'â‚¦4200' || val === 'â‚¦4150') {
            console.log('ðŸ”„ Auto-fixing dynamic price:', el);
            if (el.value) el.value = val.replace('4200', '2200').replace('4150', '2150');
            if (el.textContent) el.textContent = val.replace('4200', '2200').replace('4150', '2150');
        }
    });
}, 2000);
</script>
</body>
</html>

